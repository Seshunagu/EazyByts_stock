<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login — StockSim</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
  *{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif;}
  body{height:100vh; display:flex; justify-content:center; align-items:center; background: linear-gradient(135deg, #0f1724, #071b2a); color:#fff;}
  .card{background: rgba(255,255,255,0.05); border-radius:16px; padding:40px; width:350px; backdrop-filter: blur(10px);}
  h2{text-align:center;margin-bottom:24px;}
  .form-group{margin-bottom:16px;}
  label{display:block;margin-bottom:6px;font-size:14px;color:#94a3b8;}
  input{width:100%; padding:12px; border-radius:10px; border:none; background: rgba(255,255,255,0.1); color:#fff; font-size:14px;}
  input:focus{outline:none; background: rgba(255,255,255,0.2);}
  .btn{width:100%; padding:12px; border-radius:10px; border:none; cursor:pointer; font-weight:600; font-size:15px; margin-bottom:12px;}
  .btn-login{background: linear-gradient(90deg,#06b6d4,#7c3aed); color:#041021;}
  .btn-register{background: transparent; border:1px solid #06b6d4; color:#06b6d4;}
  .switch{text-align:center;margin-top:12px;font-size:13px; color:#94a3b8; cursor:pointer;}
  .switch span{color:#06b6d4;}
</style>
</head>
<body>

<div class="card" id="authCard">
  <h2 id="authTitle">Login to StockSim</h2>

  <!-- LOGIN FORM -->
  <div id="loginForm">
    <div class="form-group">
      <label>Email</label>
      <input type="email" id="loginEmail" placeholder="you@example.com">
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="loginPassword" placeholder="••••••••">
    </div>
    <button class="btn btn-login" id="doLogin">Login</button>
    <div class="switch">Don't have an account? <span id="showRegister">Register</span></div>
  </div>

  <!-- REGISTER FORM -->
  <div id="registerForm" style="display:none;">
    <div class="form-group">
      <label>Full Name</label>
      <input type="text" id="regName" placeholder="John Doe">
    </div>
    <div class="form-group">
      <label>Email</label>
      <input type="email" id="regEmail" placeholder="you@example.com">
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="regPassword" placeholder="••••••••">
    </div>
    <div class="form-group">
      <label>Confirm Password</label>
      <input type="password" id="regConfirmPassword" placeholder="••••••••">
    </div>
    <button class="btn btn-login" id="doRegister">Register</button>
    <div class="switch">Already have an account? <span id="showLogin">Login</span></div>
  </div>
</div>

<script>
const API = "https://seshu-eazybyts-stock.onrender.com/api/users";

// Toggle forms
document.getElementById('showRegister').onclick = ()=>{
  document.getElementById('loginForm').style.display='none';
  document.getElementById('registerForm').style.display='block';
  document.getElementById('authTitle').textContent='Create Account';
}
document.getElementById('showLogin').onclick = ()=>{
  document.getElementById('loginForm').style.display='block';
  document.getElementById('registerForm').style.display='none';
  document.getElementById('authTitle').textContent='Login to StockSim';
}

// REGISTER
document.getElementById('doRegister').onclick = async ()=>{
  const name = document.getElementById('regName').value || "Trader";
  const email = document.getElementById('regEmail').value.trim();
  const password = document.getElementById('regPassword').value;
  const confirm = document.getElementById('regConfirmPassword').value;

  if(!email || !password) return alert("Email and password required");
  if(password !== confirm) return alert("Passwords do not match");

  try {
    const res = await fetch(`${API}/register`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({name,email,password})
    });
    const data = await res.json();
    if(res.ok){
      alert("Registration successful. Please login now.");
      document.getElementById('showLogin').click(); // switch back to login form
    } else {
      alert("Error: "+data.message);
    }
  } catch(err){
    alert("Network error: "+err);
  }
}


// LOGIN
document.getElementById('doLogin').onclick = async ()=>{
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  if(!email || !password) return alert("Email and password required");

  try {
    const res = await fetch(`${API}/login`, {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({email,password})
    });
    const user = await res.json();
    if(res.ok){
      localStorage.setItem("session", JSON.stringify(user));
      window.location.href = "trade.html";
    } else {
      alert("Invalid email or password");
    }
  } catch(err){
    alert("Network error: "+err);
  }
}
</script>

</body>
</html>
