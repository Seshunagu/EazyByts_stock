<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login — StockSim</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
  *{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif;}
  body{height:100vh; display:flex; justify-content:center; align-items:center; background: linear-gradient(135deg, #0f1724, #071b2a); color:#fff;}
  .card{background: rgba(255,255,255,0.05); border-radius:16px; padding:40px; width:350px; backdrop-filter: blur(10px);}
  h2{text-align:center;margin-bottom:24px;}
  .form-group{margin-bottom:16px;}
  label{display:block;margin-bottom:6px;font-size:14px;color:#94a3b8;}
  input{width:100%; padding:12px; border-radius:10px; border:none; background: rgba(255,255,255,0.1); color:#fff; font-size:14px;}
  input:focus{outline:none; background: rgba(255,255,255,0.2);}
  .btn{width:100%; padding:12px; border-radius:10px; border:none; cursor:pointer; font-weight:600; font-size:15px; margin-bottom:12px;}
  .btn-login{background: linear-gradient(90deg,#06b6d4,#7c3aed); color:#041021;}
  .btn-register{background: transparent; border:1px solid #06b6d4; color:#06b6d4;}
  .switch{text-align:center;margin-top:12px;font-size:13px; color:#94a3b8; cursor:pointer;}
  .switch span{color:#06b6d4;}

  /* Updated Alert Modal */
  .alert-overlay{
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.7); display:flex;
    align-items:center; justify-content:center; z-index:1000;
    display:none; opacity:0; transition:opacity 0.3s ease-in-out;
  }
  .alert-overlay.show{opacity:1;}
  .alert-box{
    background:#0b1220; padding:32px; border-radius:20px; width:320px;
    text-align:center; box-shadow:0 8px 24px rgba(0,0,0,0.5);
    transform:scale(0.7); opacity:0;
    transition:transform 0.3s ease, opacity 0.3s ease;
  }
  .alert-box.show{transform:scale(1); opacity:1;}
  .alert-box h3{margin-bottom:16px; font-size:20px; font-weight:600; color:#fff;}
  .alert-box p{margin-bottom:20px; font-size:15px; color:#cbd5e1; line-height:1.5;}
  .alert-box button{
    padding:12px 24px; border:none; border-radius:10px;
    background:linear-gradient(90deg,#06b6d4,#7c3aed);
    color:#041021; font-weight:600; font-size:14px; cursor:pointer;
    transition:transform 0.2s ease, box-shadow 0.2s ease;
  }
  .alert-box button:hover{
    transform:translateY(-2px);
    box-shadow:0 4px 12px rgba(6,182,212,0.4);
  }
  @keyframes pop{
    from{transform:scale(0.7); opacity:0;}
    to{transform:scale(1); opacity:1;}
  }
</style>
</head>
<body>

<div class="card" id="authCard">
  <h2 id="authTitle">Login to StockSim</h2>

  <!-- LOGIN FORM -->
  <div id="loginForm">
    <div class="form-group">
      <label>Email</label>
      <input type="email" id="loginEmail" placeholder="you@example.com">
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="loginPassword" placeholder="••••••••">
    </div>
    <button class="btn btn-login" id="doLogin">Login</button>
    <div class="switch">Don't have an account? <span id="showRegister">Register</span></div>
  </div>

  <!-- REGISTER FORM -->
  <div id="registerForm" style="display:none;">
    <div class="form-group">
      <label>Full Name</label>
      <input type="text" id="regName" placeholder="John Doe">
    </div>
    <div class="form-group">
      <label>Email</label>
      <input type="email" id="regEmail" placeholder="you@example.com">
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="regPassword" placeholder="••••••••">
    </div>
    <div class="form-group">
      <label>Confirm Password</label>
      <input type="password" id="regConfirmPassword" placeholder="••••••••">
    </div>
    <button class="btn btn-login" id="doRegister">Register</button>
    <div class="switch">Already have an account? <span id="showLogin">Login</span></div>
  </div>
</div>

<!-- Custom Alert -->
<div class="alert-overlay" id="alertOverlay">
  <div class="alert-box">
    <h3 id="alertTitle">Notice</h3>
    <p id="alertMessage">Something happened</p>
    <button onclick="closeAlert()">OK</button>
  </div>
</div>

<script>
const API = "https://seshu-eazybyts-stock.onrender.com/api/users";

// Custom alert function
function showAlert(message, title="Notice"){
  document.getElementById('alertTitle').textContent = title;
  document.getElementById('alertMessage').textContent = message;
  const overlay = document.getElementById('alertOverlay');
  const box = overlay.querySelector('.alert-box');
  overlay.style.display = 'flex';
  setTimeout(() => {
    overlay.classList.add('show');
    box.classList.add('show');
  }, 10);
}
function closeAlert(){
  const overlay = document.getElementById('alertOverlay');
  const box = overlay.querySelector('.alert-box');
  overlay.classList.remove('show');
  box.classList.remove('show');
  setTimeout(() => {
    overlay.style.display = 'none';
  }, 300);
}

// Toggle forms
document.getElementById('showRegister').onclick = ()=>{
  document.getElementById('loginForm').style.display='none';
  document.getElementById('registerForm').style.display='block';
  document.getElementById('authTitle').textContent='Create Account';
}
document.getElementById('showLogin').onclick = ()=>{
  document.getElementById('loginForm').style.display='block';
  document.getElementById('registerForm').style.display='none';
  document.getElementById('authTitle').textContent='Login to StockSim';
}

// REGISTER
document.getElementById('doRegister').onclick = async ()=>{
  const name = document.getElementById('regName').value || "Trader";
  const email = document.getElementById('regEmail').value.trim();
  const password = document.getElementById('regPassword').value;
  const confirm = document.getElementById('regConfirmPassword').value;

  if(!email || !password) return showAlert("Email and password required","Error");
  if(password !== confirm) return showAlert("Passwords do not match","Error");

  try {
    const res = await fetch(`${API}/register`, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({name,email,password})
    });
    const data = await res.json();
    if(res.ok){
      showAlert("Registration successful. Please login now.","Success");
      document.getElementById('showLogin').click();
    } else {
      showAlert(data.message || "Registration failed","Error");
    }
  } catch(err){
    showAlert("Network error: "+err,"Error");
  }
}

// LOGIN
document.getElementById('doLogin').onclick = async ()=>{
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  if(!email || !password) return showAlert("Email and password required","Error");

  try {
    const res = await fetch(`${API}/login`, {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({email,password})
    });
    const user = await res.json();
    if(res.ok){
      localStorage.setItem("session", JSON.stringify(user));
      window.location.href = "trade.html";
    } else {
      showAlert("Invalid email or password","Error");
    }
  } catch(err){
    showAlert("Network error: "+err,"Error");
  }
}
</script>

</body>
</html>
